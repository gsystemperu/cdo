var reporte=0;Ext.define("MyDesktop.app.views.ConsultaContratos",{extend:"Ext.grid.Panel",alias:"widget.wconsultacontratos",requires:["MyDesktop.app.stores.ConsultasContratos","MyDesktop.app.stores.Trabajadores","MyDesktop.app.stores.Productos","Ext.ux.IFrame"],id:"wconsultacontratos",initComponent:function(){storecontratos=Ext.create("MyDesktop.app.stores.ConsultasContratos");storetrabajadores=Ext.create("MyDesktop.app.stores.TrabajadoresTipo");storetiendas=Ext.create("MyDesktop.app.stores.Tiendas");var a=this;Ext.apply(a,{layout:"fit",id:"dgvContratosRegistratos",sortableColumns:false,store:storecontratos,columns:[{xtype:"rownumberer"},{text:"Fecha Contrato",flex:0.8,sortable:true,dataIndex:"fecontrato",align:"center"},{text:"Tienda de Origen",flex:2,sortable:true,dataIndex:"tienda",align:"left"},{text:"Vendedor",flex:2,sortable:true,dataIndex:"trabajador",align:"left"},{text:"Cliente",flex:2,sortable:true,dataIndex:"cliente",align:"left"},{xtype:"numbercolumn",text:"Total de Contrato",flex:1,sortable:true,dataIndex:"totalcontrato",align:"right"},{text:"Estado Contrato",flex:1,sortable:true,dataIndex:"estado",align:"center"},{text:"Tipo de Documento",flex:1,sortable:true,dataIndex:"tipodoc",align:"center"},{text:"Estado",flex:1,sortable:true,dataIndex:"tdocestado",align:"left"}],listeners:{itemclick:function(d,b,f,c,g){}},tbar:[{xtype:"button",text:"Imprimir",iconCls:"boton-print",disabled:false,id:"btnImprimirListaContratos",handler:function(){a.imprimirReporteContratoConsulta()}},"-",{xtype:"button",text:"Actualizar Lista",iconCls:"icon-grid",id:"btnActualizarListaContratos",listeners:{click:function(){store=Ext.getCmp("dgvContratosRegistratos").getStore();store.getProxy().extraParams={pdesde:"",phasta:"",pidvendedor:0,pidtienda:0,ptipocancel:Ext.getCmp("cboPorTipoPago").getValue()};store.load();reporte=0}}},{xtype:"combobox",fieldLabel:"Trabajador",id:"btnComboTrabajador",flex:0.5,labelWidth:60,store:storetrabajadores,valueField:"id",displayField:"ncompleto",emptyText:"----- Seleccionar ----",query:"local",editable:false,listeners:{select:function(d,b,c){store=Ext.getCmp("dgvContratosRegistratos").getStore();store.getProxy().extraParams={pdesde:"",phasta:"",pidvendedor:d.getValue(),pidtienda:0,ptipocancel:Ext.getCmp("cboPorTipoPago").getValue()};store.load();reporte=1}}},"-",{xtype:"combobox",fieldLabel:"Tienda",id:"btnComboTienda",store:storetiendas,valueField:"id",displayField:"direc",emptyText:"----- Seleccionar ----",query:"local",editable:false,flex:0.7,listeners:{select:function(d,b,c){store=Ext.getCmp("dgvContratosRegistratos").getStore();store.getProxy().extraParams={pdesde:"",phasta:"",pidvendedor:0,pidtienda:d.getValue(),ptipocancel:Ext.getCmp("cboPorTipoPago").getValue()};store.load();reporte=3}}},"-",{xtype:"label",text:"Desde"},{xtype:"datefield",value:new Date(),id:"dpDesde",format:"d/m/Y",flex:0.3},{xtype:"label",text:"Hasta"},{xtype:"datefield",value:new Date(),id:"dpHasta",format:"d/m/Y",flex:0.3},{xtype:"combo",id:"cboPorTipoPago",store:new Ext.data.ArrayStore({fields:["id","descrip"],data:[[1,"Fecha Emisi\xf3n"],[2,"Fecha Cancelaci\xf3n"]]}),displayField:"descrip",valueField:"id",value:1,editable:false,query:"local"},{xtype:"button",text:"Buscar",iconCls:"x-ico-lupa",handler:function(){store=Ext.getCmp("dgvContratosRegistratos").getStore();store.getProxy().extraParams={pdesde:Ext.getCmp("dpDesde").getValue(),phasta:Ext.getCmp("dpHasta").getValue(),pidvendedor:0,pidtienda:0,ptipocancel:Ext.getCmp("cboPorTipoPago").getValue()};store.load();reporte=2}}]});this.callParent(arguments)},imprimirReporteContratoConsulta:function(){switch(reporte){case 1:var b="";var e="";var a=Ext.getCmp("btnComboTrabajador").getValue();var f=0;var d=1;break;case 2:var b=Ext.getCmp("dpDesde").getRawValue();var e=Ext.getCmp("dpHasta").getRawValue();var a=0;var f=0;var d=Ext.getCmp("cboPorTipoPago").getValue();break;case 3:var b="";var e="";var a=0;var f=Ext.getCmp("btnComboTienda").getValue();var d=1;break;case 0:var b="";var e="";var a=0;var f=0;var d=1;break}var c="reportes/imprimircontratosconsultas?pdesde="+b+"&phasta="+e+"&pidvendedor="+a+"&pidtienda="+f+"&ptipocancel="+d;tabpanel=Ext.getCmp("tpContenedorApp");if(!tabpanel.getChildByElement("tabpdfcontratoconsultas")){tabpanel.add({xtype:"panel",closable:true,id:"tabpdfcontratoconsultas",title:"Reporte de Contratos",layout:"fit",items:[{xtype:"uxiframe",src:c}]})}tabpanel.setActiveTab("tabpdfcontratoconsultas")}});