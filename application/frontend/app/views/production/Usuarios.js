Ext.define("MyDesktop.app.views.Usuarios",{extend:"Ext.panel.Panel",alias:"widget.wusuarios",requires:["MyDesktop.app.stores.Usuarios"],initComponent:function(){me=this;storeusuarios=Ext.create("MyDesktop.app.stores.Usuarios");storePerfil=Ext.create("MyDesktop.app.stores.Perfiles");Ext.apply(me,{layout:{align:"stretch",type:"hbox"},items:[{xtype:"panel",flex:1,layout:{align:"stretch",type:"fit"},border:false,items:[{xtype:"panel",flex:2,layout:"fit",border:false,items:[{xtype:"gridpanel",id:"dgvusuarios",store:storeusuarios,sortableColumns:false,columns:[{xtype:"rownumberer"},{text:"Id",dataIndex:"_usuid",flex:0.5,hidden:true},{text:"Nombres y Apellidos",flex:2,textAlign:"left",dataIndex:"_usudatos"},{text:"Usuario",textAlign:"right",flex:0.9,dataIndex:"_usulogin"},{xtype:"actioncolumn",width:20,items:[{iconCls:"remove",tooltip:"Eliminar",handler:function(b,c,a){}}]}],viewConfig:{listeners:{itemclick:function(b,a,f,c,g){var d=Ext.getCmp("dgvusuarios");a=d.getSelectionModel().getSelection();if(a[0]){Ext.getCmp("frmusuario").loadRecord(a[0])}}}}}]}]},{xtype:"panel",flex:0.8,frame:"true",layout:{type:"fit"},border:false,items:[{xtype:"form",padding:"10 5 10 5",bodyPadding:"5",layout:{type:"vbox",align:"stretch"},defaults:{labelWidth:150},id:"frmusuario",items:[{xtype:"hiddenfield",id:"txtIdUsuario",name:"_usuid"},{xtype:"textfield",fieldLabel:"<b>Usuario</b>",id:"txtUsuario",name:"_usulogin",allowBlank:false},{xtype:"textfield",fieldLabel:"<b>Contrase\xf1a</b>",id:"txtClave",inputType:"password",allowBlank:false},{xtype:"textfield",fieldLabel:"<b>Nombres y Apellidos</b>",id:"txtNomApe",name:"_usudatos",allowBlank:false},{xtype:"combobox",id:"cboPerfil",store:storePerfil,name:"_id_perfil",fieldLabel:"<b>Nivel Usuario</b>",valueField:"_id_perfil",displayField:"_descripcion",editable:false,queryMode:"remote",allowBlank:false}]}],bbar:["->",{xtype:"button",text:"<b>Nuevo</b>",iconCls:"add",handler:function(){me.setLimpiarFrm()}},{xtype:"button",text:"<b>Grabar</b>",iconCls:"boton-save",handler:function(){me.actionGuardarUsuario()}}]}]});this.callParent(arguments)},setLimpiarFrm:function(){Ext.getCmp("frmusuario").getForm().reset();Ext.getCmp("txtUsuario").focus()},actionGuardarUsuario:function(){var a=Ext.getCmp("frmusuario");if(a.isValid()){Ext.Ajax.request({url:"usuarios/actualizarusuario",params:{vId:Ext.getCmp("txtIdUsuario").getValue(),vNomApe:Ext.getCmp("txtNomApe").getValue(),vLogin:Ext.getCmp("txtUsuario").getValue(),vClave:Ext.getCmp("txtClave").getValue(),vIdPerfil:parseInt(Ext.getCmp("cboPerfil").getValue()),vUsuario:"SISTEMA"},success:function(f,c,d,e){var b=MyDesktop.app.util.Util.decodeJSON(f.responseText);if(b.success){Ext.each(b.items,function(g){if(g.ERROR>0){Ext.getCmp("dgvusuarios").getStore().load();Ext.getCmp("frmusuario").getForm().reset()}})}}})}}});